# ç»„åˆæ•° `C(n, m)`

åˆå«ã€ŒäºŒé¡¹å¼ç³»æ•°ã€(binomial coefficient)ï¼Œä¸º `(1+x)â¿` å±•å¼€å x çš„ç³»æ•°ï¼ˆå…¶ä¸­ n ä¸ºè‡ªç„¶æ•°ï¼‰

é€šé¡¹å…¬å¼ï¼š`C(n, m) = n! / (m! * (n-m)!)`

ä¸ºé˜²æº¢å‡ºï¼Œä¸èƒ½ç›´æ¥ä¹˜ã€‚

# æ³•ä¸€ï¼šç”¨é€’æ¨å…¬å¼ `c(n, m) = c(n-1, m) + c(n-1, m-1)`

```cpp
    long long c(int n, int m) {
        long long f[n + 1][n + 1];
        for (int i = 0; i <= n; i++) {
            f[i][0] = 1;
            for (int j = 1; j <= i; j++) {
                f[i][j] = (f[i - 1][j] + f[i - 1][j - 1]);
            }
        }
        long long ans = f[n][m];
        return ans;
    }
```

# æ³•äºŒï¼Œç”¨é€’æ¨å…¬å¼ `c(n, m) = (n-m+1) / m * c(n, m-1)`

```cpp
    long long c(int n, int m) {
        long long c = 1; // c(n, 0)
        for (int i = 1; i <= m; i++) {
            c = c * (n - i + 1) / i; // ä¸èƒ½å†™æˆ c *= (n-i+1) / iï¼Œå› ä¸ºå³è¾¹å¯èƒ½ä¸æ˜¯æ•´æ•°
        }
        return c;
    }
```

è‹¥æ•°ç›®å¾ˆå¤§ï¼Œè¦æ±‚æ¨¡ï¼Œé€’æ¨å¼ä¸­æœ‰é™¤æ³•ï¼Œä¸èƒ½ç®€å•æ±‚æ¨¡ã€‚éœ€è¦ç”¨åˆ°æ¨¡é€†å…ƒã€‚

ä¸‹é¢æ±‚æ¨¡é€†å…ƒçš„æ–¹æ³•ï¼Œé€‚ç”¨äºæ±‚ä» 1 å¼€å§‹çš„ä¸€ä¸²è¿ç»­çš„æ•°çš„æ¨¡é€†å…ƒã€‚

```cpp
    è®¾ p = k Ã— i + r,
    k Ã— i + r â‰¡ 0 (mod p)ï¼Œä¸¤è¾¹åŒæ—¶ä¹˜ä»¥ iâ»Â¹ Ã— râ»Â¹ å¾—ï¼š
    k Ã— râ»Â¹ + iâ»Â¹ â‰¡ 0 (mod p)
    iâ»Â¹ â‰¡ âˆ’k Ã— râ»Â¹
    iâ»Â¹ â‰¡ âˆ’âŒŠp/iâŒ‹ Ã— (p mod i)â»Â¹ (mod p)
    iâ»Â¹ â‰¡ (p âˆ’ âŒŠp/iâŒ‹) Ã— (p mod i)â»Â¹ (mod p)
```

å³ï¼Œæœ€ç»ˆå…¬å¼ï¼š<font color="green">`iâ»Â¹ â‰¡ (p âˆ’ âŒŠp/iâŒ‹) Ã— (p mod i)â»Â¹ (mod p)`</font>

ç”±æ­¤å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š

```cpp
    // c(n, m) % p
    long long c_mod(int n, int m, int p) {
        // çº¿æ€§æ±‚é€†å…ƒ
        vector<long long> inv(n + 1);
        inv[1] = 1;
        for (int i = 2; i <= n; i++) {
            inv[i] = (p - p / i) * inv[p % i] % p;
        }
        // é€’æ¨æ±‚ç»„åˆæ•°ï¼Œåˆå€¼ C(k, 0) = 1
        long long c = 1;
        for (int i = 1; i <= m; i++) {
            c = c * ((n - i + 1) % p) * (inv[i] % p);
        }
        return c;
    }
```

# æ³•ä¸‰ï¼Œé€†å…ƒæ³•

ç”¨å…¬å¼ `c(n,m) = n! / m! / (n-m)!`ï¼Œç›´æ¥ç®—ï¼Œä½†è¦å–æ¨¡ã€‚

æ•´æ•° a å¯¹åŒä½™ p çš„ ã€Œæ¨¡é€†å…ƒï¼ˆæ¨¡å€’æ•°ï¼‰ã€xï¼Œmodular multiplicative inverse ğ‘¥ of ğ‘ modulo ğ‘ï¼Œå®šä¹‰ä¸º
```
    ğ‘ â‹… ğ‘¥ â‰¡ 1 (mod ğ‘) æˆ– aâ‹…x mod p = 1
```

è¯¥ã€Œæ¨¡é€†å…ƒã€å­˜åœ¨çš„å……è¦æ¡ä»¶æ˜¯ï¼ša ä¸ p äº’è´¨ã€‚é¢˜ç›®é‡Œé€šå¸¸ p æ˜¯è´¨æ•°ï¼Œåˆ™è‚¯å®šä¸ a äº’è´¨ã€‚

ç”¨ `inv(a)` å–ä»£ xï¼Œå¾— `a â‹… inv(a) â‰¡ 1 (mod p)`

åˆ™ `c(n, m) â‰¡ n! â‹… inv(m!) â‹… inv((n-m)!) (mod p)`

ä¹Ÿå°±æ˜¯

<font color="green">`c(n,m) % p = (n! % p) â‹… (inv(m!) % p) â‹… (inv((n-m)!) % p)`</font>

å¦‚ä½•æ±‚ `inv(a)`ï¼Ÿ

ç”±è´¹é©¬å°å®šç† (Fermat's little theorem)ï¼Œ`aáµ– â‰¡ a (mod p)`ã€‚è‹¥ p æ˜¯è´¨æ•°ï¼Œåˆ™è¿˜æœ‰ `aáµ–â»Â¹ â‰¡ 1 (mod p)`ã€‚å¯¹æ¯” `inv(a)` çš„å®šä¹‰ `a â‹… inv(a) â‰¡ 1 (mod p)`ï¼Œå¯å¾—æœ€ç»ˆå…¬å¼ <font color="green">`inv(a) â‰¡ aáµ–â»Â² (mod p)`</font>ã€‚

è‹¥ a å’Œ p éƒ½å¾ˆå¤§ï¼Œä¹Ÿä¸èƒ½ç›´æ¥ç”¨ `pow(a, p-2)`ï¼Œè€Œè¦é€æ¬¡ä¹˜ï¼Œå¹¶ä¸”æ¯æ¬¡ä¹˜åå–æ¨¡ã€‚ä¸ºåŠ å¿«é€Ÿåº¦ï¼Œå¯ç”¨å¿«é€Ÿå¹‚æ³•ã€‚

ä»£ç ï¼š[`combination_modulo_fermat.cpp`](code/combination_modulo_fermat.cpp)

```cpp
    // éé€’å½’å¿«é€Ÿå¹‚ï¼Œæ±‚æ¨¡ï¼šaâ¿ % p
    long long bin_pow_mod(long long a, long long n, long long p) {
        a %= p;
        if (a == 0) {
            return 0;
        }
        long long ans = 1;
        while (n > 0) {
            if (n & 1) {   // å¦‚æœnå½“å‰æœ«ä½ä¸º1
                ans = (ans * a) % p;
            }
            a = (a * a) % p;
            n >>= 1;       // n/=2; nå³ç§»ä¸€ä½ï¼Œç»™ä¸‹æ¬¡å¾ªç¯åšå‡†å¤‡
        }
        return ans;
    }
    long long inv(long long a, long long p){
        return bin_pow_mod(a, p - 2, p);
    }

    long long c_mod(long long n, long long k, long long p){
        long long fact[n + 1];
        fact[0] = 1;
        for (long long i = 1; i <= n; i++) {
            fact[i] = ((i % p) * fact[i - 1]) % p;
        }
        return ((fact[n] * inv(fact[k], p) % p) * inv(fact[n - k], p)) % p;
    }
```

# æ³•å››ï¼ŒLucas å…¬å¼

# åˆ†è§£è´¨å› æ•°æ³•

#








# references

- https://zhuanlan.zhihu.com/p/680988193  æ–¹æ³•åŠè‹¥å¹²é¢˜ç›®
- https://zhuanlan.zhihu.com/p/652659552 æ¶‰åŠåˆ°å¿«é€Ÿå¹‚
- https://blog.csdn.net/boliu147258/article/details/105758354
- https://www.geeksforgeeks.org/binomial-coefficient-dp-9/
-
- https://stackoverflow.com/questions/1838368/calculating-the-amount-of-combinations Knuth's algorithm
